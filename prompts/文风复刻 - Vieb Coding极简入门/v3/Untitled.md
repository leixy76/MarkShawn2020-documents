
# **我们为什么需要精准的上下文工程**

  

_作者｜手工川_

  

在前端世界里，总有一些工具，你第一次看到就会心一笑：

——这不就是我一直想要的功能吗？

  

前段时间，我在 Dify 的源码里挖出了一款非常特别的插件：

[code-inspector-plugin](https://www.npmjs.com/package/code-inspector-plugin)![Attachment.tiff](file:///Attachment.tiff)。

  

它能在浏览器里一键跳转到对应组件的源代码位置。

如果你也是重度 vibe coder，你大概能理解这有多爽：

不再需要在上千个文件中搜来搜去，光标点下去，IDE 就直接打开那一行。

上下文准确到极致。

  

可当我真的想把它集成进自己的开发流时，问题就开始了。

---

## **一、当「好工具」变成「难接入」**

  

我花了整整两天时间，去搞清楚为什么它没法被外部项目用 pnpm add 的方式正常引用。

  

这听起来像是个小问题，但其实暴露了很多典型的「生态摩擦」：

- monorepo 内的包依赖路径太固定；
    
- 打包脚本里假设运行环境；
    
- 以及，开发者自己没考虑被外部引用的场景。
    

  

最终我发现，罪魁祸首藏在 packages/core/src/server/use-client.ts:382。

代码里生成的缓存文件路径是写死的，导致外部引用会直接报 Module Not Found。

  

解决办法其实很优雅：

我让生成逻辑自动定位到**执行环境的 .cache 文件夹**，

从而既支持 monorepo 内部 demo，又兼容外部项目。

一次改动，双赢。

---

## **二、「保持同步」的代价**

  

第二个坑，更微妙。

  

我原本只想在原版基础上加一个小功能，但为了发 npm 包、让团队方便使用，

我不得不改 scope name——这意味着整个项目要和 upstream 脱轨。

  

如果你也维护过前端生态的多包系统，就知道这意味着什么：

所有依赖链、类型声明、import 路径都要改。

一个 feature，最后变成一场 fork。

  

那一刻我意识到：

很多我们以为“轻松发个包”的操作，其实背后是整个软件供应链的分叉。

  

于是我去找了个更聪明的办法——用 **Cloudsmith 私有源**。

  

它允许我在不改包名的前提下，自建一个 npm registry。

再在 .npmrc 中指定：

```
@code-inspector:registry=https://npm.cloudsmith.io/mark/code-inspector/
always-auth=true
```

这样，pnpm add code-inspector-plugin 时，会优先从我自己的 registry 拉取，

如果找不到，再回退到 npmjs。

这就是我理想中的状态：

不打扰 upstream、不破坏生态、也不牺牲开发体验。

---

## **三、我们真正追求的，其实不是“跳转”**

  

改造完的那一刻，我并没有多兴奋。

反而在想：

为什么我要花这么多时间，只为了**拿到一个组件路径**？

  

这不是懒，也不是完美主义。

而是因为，在今天的 AI + 工具链协作环境下，**上下文就是一切**。

  

我们不再是单纯写代码的人。

我们在和 Claude、Copilot、Codeium、Cursor 一起协作；

我们让模型读懂项目结构、推理依赖关系、生成补丁。

可这一切的前提，是——模型拿到的上下文，必须**精准**。

  

一个路径的偏差、一处依赖的缺失，

就可能让模型输出的内容偏离方向。

  

所谓「精准上下文工程」，

其实是这个时代的新编程范式：

  

> 让机器在尽可能真实、完整、细粒度的语境中工作。

---

## **四、我们需要新的「工程意识」**

  

过去我们优化的，是算法、性能、打包速度；

今天我们优化的，是「上下文的质量」。

- 我们在为 LLM 构建上下文索引；
    
- 在让代码与语义自动对齐；
    
- 在为多 Agent 工作流定义「共享世界模型」。
    

  

而这一切的核心，其实都回到那句老话——

  

> 工程师不是写代码的人，

> 工程师是搭建世界边界的人。

---

## **五、写在最后**

  

我很喜欢一句话：

  

> 「优秀的工程师不会把问题藏在工具后面，而是让工具显得理所当然。」

  

在这次“魔改”之后，我体会到的反而是另一层意义：

每个小改动，都在让我们离真正的自动化、协作式开发更近一步。

  

未来的 IDE 可能不再是单机，而是一个有上下文自觉的智能体。

而今天的这些插件、小工具、小技巧，

就是通往那个未来的路标。

  

愿每一位 coder，都能拥有属于自己的“精准上下文”。
